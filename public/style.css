:root {
    --bg: #0e0f12;
    --panel: #15171c;
    --muted: #a7b0c0;
    --text: #e8ecf1;
    --user: #2b90d9;
    --model: #2a2f39;
    --ring: #3b82f6;
    }
    * { box-sizing: border-box; }
    html,body { height: 100%; }
    body {
    margin: 0; background: var(--bg); color: var(--text);
    font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
    }
    .app { display: grid; grid-template-rows: auto 1fr auto; height: 100vh; }
    
    
    .topbar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 14px; background: var(--panel); border-bottom: 1px solid #1f232b;
    }
    .brand { font-weight: 700; letter-spacing: .2px; }
    .controls { display: flex; gap: 10px; align-items: center; }
    .controls label { font-size: 12px; color: var(--muted); display: grid; gap: 4px; }
    .controls select, .controls input, .controls button {
    background: #0f1218; color: var(--text); border: 1px solid #252a33; border-radius: 8px;
    padding: 8px 10px; outline: none;
    }
    .controls button { cursor: pointer; }
    .controls select:focus, .controls input:focus, .controls button:focus { border-color: var(--ring); }
    
    
    #chat { padding: 18px; overflow: auto; }
    .message { display: grid; gap: 8px; margin: 0 0 14px; }
    .row { display: flex; gap: 10px; align-items: flex-start; }
    .avatar { width: 28px; height: 28px; border-radius: 50%; background: #2a2f39; display: grid; place-items: center; font-size: 12px; color: #cfd6e6; }
    .bubble { padding: 12px 14px; border-radius: 14px; max-width: 900px; white-space: pre-wrap; }
    .user .bubble { background: #103046; border: 1px solid #0f3a5a; }
    .assistant .bubble { background: var(--model); border: 1px solid #2f3542; }
    
    
    #composer {
    display: grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px; background: var(--panel); border-top: 1px solid #1f232b;
    }
    #input { resize: none; background: #0f1218; color: var(--text); border: 1px solid #252a33; border-radius: 10px; padding: 12px 12px; min-height: 44px; }
    #send { padding: 0 16px; border: 1px solid #2b3340; background: #1a1f27; color: var(--text); border-radius: 10px; cursor: pointer; font-weight: 600; }
    #send:disabled { opacity: .6; cursor: not-allowed; }
    
    
    .loading { opacity: 0.7; }
    
    .bubble { white-space: normal; }
/* Typography */
.bubble p { margin: .5rem 0; }
.bubble :where(h1,h2,h3){ margin:.6rem 0 .35rem; line-height:1.2; }
.bubble h1{ font-size:1.25rem; border-bottom:1px solid #2f3542; padding-bottom:.2rem; }
.bubble h2{ font-size:1.1rem; color:#cfe1ff; }
.bubble h3{ font-size:1rem; color:#b9c5d6; }

/* Links & emphasis */
.bubble a{ color:#80b3ff; text-decoration:underline; text-underline-offset:2px; }
.bubble strong{ color:#fff; }
.bubble em{ opacity:.95; }

/* Inline code */
.bubble code:not(pre code){
  background:#0f1218; border:1px solid #2b3340; border-radius:6px;
  padding:.1rem .35rem; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
}

/* Code blocks */
.bubble pre{
  background:#0d1016; border:1px solid #2b3340; border-radius:12px;
  padding:12px; overflow:auto; margin:.6rem 0;
}
.bubble pre code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size:.9rem;
}

/* Blockquotes */
.bubble blockquote{
  margin:.6rem 0; padding:.4rem .8rem;
  border-left:4px solid #3b82f6; background:#0f1218; color:#cfd6e6;
  border-radius:8px 12px 12px 8px;
}

/* Lists */
.bubble ul{ padding-left:1.2rem; margin:.4rem 0; }
.bubble ol{ padding-left:1.4rem; margin:.4rem 0; }
.bubble li{ margin:.25rem 0; }

/* Horizontal rule */
.bubble hr{ border:0; border-top:1px dashed #2f3542; margin:.8rem 0; }

/* Tables */
.bubble table{ border-collapse:collapse; margin:.6rem 0; width:100%; }
.bubble th,.bubble td{ border:1px solid #2f3542; padding:.4rem .6rem; text-align:left; }
.bubble th{ background:#18202c; font-weight:600; }
.bubble[data-persona]{ position:relative; padding-top:22px; }
.bubble[data-persona]::before{
  content: attr(data-persona);
  position:absolute; top:6px; left:12px;
  font-size:.65rem; background:#1f2530; border:1px solid #2f3542;
  border-radius:999px; padding:2px 8px; color:#a7b0c0;
}

    /* mobile */
    @media (max-width: 640px) {
    .controls { display: none; }
    #chat { padding: 12px; }
    }
    /* --- Chat typing UX --- */
.avatar { position: relative; }

/* pulsing ring on avatar while thinking */
.avatar.thinking::after{
  content:""; position:absolute; inset:-3px;
  border:2px solid var(--ring); border-radius:50%;
  opacity:.6; animation: ping 1.2s ease-out infinite;
}
@keyframes ping {
  0%   { transform: scale(0.9); opacity: .6; }
  70%  { transform: scale(1.2); opacity: .2; }
  100% { transform: scale(1.2); opacity: 0; }
}

/* subtle inset glow while typing */
.avatar.typing { box-shadow: inset 0 0 0 2px var(--ring); }

.bubble { white-space: normal; position: relative; }

/* three-dot indicator inside the bubble while waiting for first bytes */
.typing-indicator{
  display: inline-flex; gap: 6px; align-items: center;
  padding: 6px 2px; opacity: .9;
}
.typing-indicator span{
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--muted); display: inline-block;
  animation: dot 1s infinite ease-in-out;
}
.typing-indicator span:nth-child(2){ animation-delay: .15s; }
.typing-indicator span:nth-child(3){ animation-delay: .30s; }

@keyframes dot {
  0%, 80%, 100% { transform: translateY(0); opacity: .4; }
  40%          { transform: translateY(-4px); opacity: 1; }
}

/* blinking caret shown while streaming text */
.caret{
  display:inline-block; width: 2px; height: 1em;
  background: #cfe1ff; margin-left: 3px; vertical-align: -2px;
  animation: caretBlink 1s steps(1) infinite;
}
@keyframes caretBlink { 50% { opacity: 0; } }
/* === Shell layout (sidebar + app) === */
.shell{ display:grid; grid-template-columns: 260px 1fr; height:100vh; }
#sidebar{
  background:#0b0c10; border-right:1px solid #1f232b; color:#cfd6e6;
  display:flex; flex-direction:column; min-width:200px; overflow:auto;
}
.s-header{ display:flex; align-items:center; justify-content:space-between; padding:10px; border-bottom:1px solid #1f232b; }
.s-title{ font-weight:700; letter-spacing:.2px; }
.s-new{ background:#1a1f27; color:var(--text); border:1px solid #2b3340; border-radius:8px; padding:6px 10px; cursor:pointer; }
#threads{ list-style:none; margin:0; padding:6px; display:grid; gap:6px; }
#threads li{
  display:grid; gap:2px; padding:10px; border:1px solid #242a34; border-radius:10px; background:#12151b; cursor:pointer;
}
#threads li.active{ border-color:#3b82f6; box-shadow:0 0 0 2px rgba(59,130,246,.15) inset; }
#threads .t-title{ font-size:13px; color:#e8ecf1; }
#threads .t-sub{ font-size:12px; color:#94a3b8; }

@media (max-width: 820px){
  .shell{ grid-template-columns: 1fr; }
  #sidebar{ display:none; }
}

/* === Edit last user message === */
.edit-btn{
  position:absolute; top:8px; right:10px; font-size:12px;
  background:#1a1f27; color:#cfd6e6; border:1px solid #2b3340;
  border-radius:6px; padding:2px 6px; cursor:pointer; opacity:.9;
}
.user .bubble{ position:relative; } /* host for .edit-btn */

.edit-area{
  width:100%; min-height:80px; border:1px solid #2b3340; border-radius:8px;
  background:#0f1218; color:#e8ecf1; padding:10px; resize:vertical; font:inherit;
}
.edit-controls{ display:flex; gap:8px; margin-top:8px; }
.edit-controls .save, .edit-controls .cancel{
  background:#1a1f27; color:#e8ecf1; border:1px solid #2b3340; border-radius:8px; padding:6px 10px; cursor:pointer;
}
/* sidebar delete button */
#threads li { position: relative; }             /* allow absolute positioning */
.t-del{
  position:absolute; top:8px; right:8px;
  background:#1a1f27; color:#cfd6e6;
  border:1px solid #2b3340; border-radius:8px;
  padding:2px 8px; font-size:12px; cursor:pointer; opacity:.75;
}
#threads li:hover .t-del{ opacity:1; }
.t-del:hover{ border-color:#ef4444; color:#fecaca; }
